<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>PEPTACO S.A – Panel de Pedidos</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 40px;
      text-align: center;
      margin: 0;
      color: #000;
    }
    input, button, select {
      padding: 10px;
      margin: 10px;
      width: 220px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }
    #panel, #cerrarBtn {
      display: none;
      margin-top: 30px;
    }
    #actualizarBtn {
      background-color: #2196f3;
      color: white;
    }
    #filtroCliente {
      display: none;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      margin-top: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
      font-size: 14px;
    }
    th {
      background-color: #333;
      color: white;
    }
  </style>
</head>
<body>

  <h2 id="tituloLogin">PEPTACO S.A – Ingreso al Panel de Pedidos</h2>
  <input type="text" id="usuario" placeholder="Usuario"><br>
  <input type="password" id="clave" placeholder="Contraseña"><br>
  <button onclick="validar()">Entrar</button>

  <button id="cerrarBtn" onclick="cerrarSesion()">Cerrar sesión</button>

  <div id="panel">
    <h1>PEPTACO S.A – Panel de Pedidos</h1>
    <button id="actualizarBtn" onclick="cargarPedidos()">Actualizar pedidos</button><br>
    <select id="filtroCliente" onchange="filtrarPorCliente()">
      <option value="">-- Filtrar por cliente --</option>
    </select>
    <table id="tablaPedidos">
      <thead>
        <tr>
          <th>Pedido</th>
          <th>Fecha ingreso</th>
          <th>Tipo de envío</th>
          <th>Cliente</th>
          <th>Domicilio</th>
          <th>Localidad</th>
          <th>CP</th>
          <th>Envío</th>
          <th>Ubicación actual</th>
          <th>Estado automático</th>
          <th>Observaciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    let pedidosGlobal = [];

    function validar() {
      const usuario = document.getElementById("usuario").value;
      const clave = document.getElementById("clave").value;

      if (usuario === "Peptaco" && clave === "EDI2025") {
        document.getElementById("panel").style.display = "block";
        document.getElementById("cerrarBtn").style.display = "inline-block";
        document.getElementById("usuario").style.display = "none";
        document.getElementById("clave").style.display = "none";
        document.querySelector("button").style.display = "none";
        document.getElementById("tituloLogin").textContent = "Acceso concedido a PEPTACO S.A";
        cargarPedidos();
      } else {
        alert("Usuario o contraseña incorrectos");
      }
    }

    function cerrarSesion() {
      location.reload();
    }

    function cargarPedidos() {
      const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSLqPu05Wv-zXa_TbMH6pHVRQwka3j-Qxq41gtT1g707J2eT1bZnnxTXWUDM7TbXQ/pub?gid=1244419517&single=true&output=csv";
      Papa.parse(url, {
        download: true,
        header: true,
        skipEmptyLines: true,
        dynamicTyping: true,
        transformHeader: h => h.trim(),
        complete: function(results) {
          pedidosGlobal = results.data;
          mostrarPedidos(pedidosGlobal);
          cargarClientes(pedidosGlobal);
        }
      });
    }

    function mostrarPedidos(pedidos) {
      const tbody = document.querySelector("#tablaPedidos tbody");
      tbody.innerHTML = "";

      const pedidosValidos = pedidos.filter(p =>
        p.Pedido && p.Cliente && p["Tipo de envío"]
      );

      if (pedidosValidos.length === 0) {
        tbody.innerHTML = `<tr><td colspan="11">No se encontraron pedidos válidos.</td></tr>`;
        return;
      }

      pedidosValidos.forEach(pedido => {
        const fila = document.createElement("tr");
        fila.innerHTML = `
          <td>${pedido.Pedido}</td>
          <td>${pedido["Fecha ingreso"]}</td>
          <td>${pedido["Tipo de envío"]}</td>
          <td>${pedido.Cliente}</td>
          <td>${pedido.Domicilio}</td>
          <td>${pedido.Localidad}</td>
          <td>${pedido.CP}</td>
          <td>${pedido["Envío"]}</td>
          <td>${pedido["Ubicación actual"]}</td>
          <td>${pedido["Estado automático"]}</td>
          <td>${pedido.Observaciones}</td>
        `;
        tbody.appendChild(fila);
      });
    }

    function cargarClientes(pedidos) {
      const select = document.getElementById("filtroCliente");
      const clientes = [...new Set(pedidos.map(p => p.Cliente).filter(Boolean))].sort();
      select.innerHTML = `<option value="">-- Filtrar por cliente --</option>`;
      clientes.forEach(cliente => {
        const option = document.createElement("option");
        option.value = cliente;
        option.textContent = cliente;
        select.appendChild(option);
      });
      select.style.display = "inline-block";
    }

    function filtrarPorCliente() {
      const clienteSeleccionado = document.getElementById("filtroCliente").value;
      if (!clienteSeleccionado) {
        mostrarPedidos(pedidosGlobal);
      } else {
        const filtrados = pedidosGlobal.filter(p => p.Cliente === clienteSeleccionado);
        mostrarPedidos(filtrados);
      }
    }
  </script>

</body>
</html>